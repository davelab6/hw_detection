# GHC Open Source Day project 2011
# by Gabrielle Roth & Michelle Rowley

#based on:
# System Information Generator v1.1
# Tim Burgess 28.11.07

#Some suggestions on the script you offered:
#Force execution by /bin/bash.  I ran it in a variety of situations, and it appears that when running in /bin/dash the environment variable $UID does not exist.  This causes a syntax error in the test that does not happen when using /bin/bash.

#Any suggestions on how to go about this? 

#Don't exit simply because memory is inadequate for our use.  Note the value, highlight it somehow, but keep on going to learn the rest of the system's features.

#Completed. I just removed the if logic and had it display the value instead. The value is the first one displayed. 

#Requests:
#Create a table to cross reference the release number returned by 'uname -r'  with terms we use daily like Edubuntu 12.04 or Edubuntu 10.04.  Please print the latter rather than the raw 'uname -r' output.  I could probably learn and adapt to the current set of values, but I'm lazy.

#Completed. I just cat'd another file that would give me the description. Should work on different flavors of Linux. Let me know if it doesn't. 

#Distinguish among the possible optical drive types, particularly a DVD R/W drive vs. a DVD-ROM drive.  I don't have any suggestions how to accomplish this, but it would 3be good information to have.

#Off the top of my head I could just use a command and just grep out the descriptions...I'll play with this later in the week. 

#if [[ $UID != 0 ]]; then echo 'Sorry, must be root. Exiting...'; exit; fi

echo "Generating system stats; please wait."
MEMORY=`free -m | grep Mem | awk '{print $2}'`
DATE=`date`
SERIAL=`dmidecode -t system | grep -i serial | sed "s/^[  ]*//"`
VERSION=`cat  /etc/*-release | grep -i DISTRIB_DESCRIPTION | sed -e "s/^.*\"\(.*\)\".*$/\"\1\"/" `
PROC=`uname -p`
# TODO: can we count on egrep availability? Probably not.
# egrep is in ubuntu so I would assume this ok. I know other flavors of linux do as well.
PROC_DETAIL=`cat /proc/cpuinfo | egrep -i "processor|vendor_id|model name|mhz"`
HD=`fdisk -l | grep "Disk /"`
NETWORK=`lspci | egrep -i "ethernet|wireless|network"`
VIDEO=`lspci | egrep -i "vga|graphics|video"`

#TODO: put this in a loop
if ls /dev/cd* 1>/dev/null
        then CD="Present"
        else CD="Not present"
fi

if ls /dev/dvd* 1>/dev/null
        then DVD="Present"
        else DVD="Not present"
fi

if ls /dev/usb* 1>/dev/null
        then USB="Present"
        else USB="Not present"
fi

OFILE=$HOME/sysinfo.txt
cat /dev/null >${OFILE}

cat > ${OFILE} <<INFO
System Information - File generated on $DATE
Memory: $MEMORY MB

$SERIAL

Version: $VERSION

Processor: $PROC
$PROC_DETAIL

HD: $HD

RAM: $MEMORY M

CD: $CD
DVD: $DVD
USB: $USB

Network: $NETWORK

Video card: $VIDEO

INFO

cat ${OFILE}
echo "Finished! Your results have been stored in ${OFILE}"
exit 0


